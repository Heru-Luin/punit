#!/usr/bin/env php
<?php

// Make sure the current working directory is the project root directory
chdir(dirname(dirname(__FILE__)));

$config = getConfig();

require $config['punit']['bootstrap'];

$classes = [
    Test\App\CalcTest::class => [
        'testSumPass',
        'testSumFail'
    ]
];

$stack = [];
$i = 1;
$pass = 0;
$fail = 0;
foreach($classes as $class => $methods) {
    foreach($methods as $method) {
        try {
            (new $class())->$method();
            $stack[$class][$method]['result'] = true;
            
            $pass++;
            
            echo "$i) $class::$method() --> \033[32m PASS \033[0m" . "\r\n";
        } catch(\Exception $e) {
            $stack[$class][$method]['result'] = false;
            $stack[$class][$method]['stack'] = $e;
            
            $fail++;
            
            echo "$i) $class::$method() --> \033[31m FAIL, ";
            echo "Error: ".$e->getMessage()." \033[0m ". "\r\n";
        } 
        
        $i++;         
    }   
}

echo "\r\n" . "\033[34m Tests: ".($pass+$fail)."\033[0m \033[32m Ok: $pass \033[0m \033[31m Failures: $fail \033[0m" . "\r\n";

function getConfig()
{
    $config = [];

    foreach (['punit.php.dist', 'punit.php'] as $fileName) {
        if (file_exists($fileName)) {
            $config = array_replace_recursive($config, require_once($fileName));
        }
    }
    return $config;
}
